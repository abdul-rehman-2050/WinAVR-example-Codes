

/* As graphic LCD used the DEM128064A model (128x64 pixels).

   Created by Serasidis Vassilis and finished at 03.Aug.2007
   Home: http://www.serasidis.gr
   e-mail: info@serasidis.gr and avrsite@yahoo.gr

   This code is ditributed under GPL licence.
*/

#include <avr/io.h>
#include <avr/pgmspace.h>

#define	lcdrs	0 		// LCD's RS pin is connected to Pin0 of AVR
#define	lcdrw	1 		// LCD's r/w pin is connected to Pin1 of AVR
#define	lcde	2       // LCD's e pin is connected to Pin2 of AVR
#define	lcdcs1	5       // LCD's CS1 pin is connected to Pin5 of AVR
#define	lcdcs2	4       // LCD's CS2 pin is connected to Pin4 of AVR
#define	lcdrst	3       // LCD's RST pin is connected to Pin3 of AVR

#define	ctrl_port	 	PORTB
#define	ctrl_port_ddr	DDRB
#define	ctrl_port_pins	PINB

#define	data_port		PORTD
#define	data_port_ddr	DDRD
#define	data_port_pins	PIND


void glcdInit (void);
void createWelcomeScreen (void);
void createRaster (void);
void delayTime (unsigned long counter);
void eStrobe (void);
void enable_cs1 (void);
void enable_cs2 (void);
void sendDataOnLCD (unsigned char data);
unsigned char readDataFromLCD (void);
void gLCDgotoXY (unsigned char lineData, unsigned char columnData);
void createWave (void);
void restoreRaster (void);
void fillDataLcdBuffer (unsigned char address, unsigned char data);
void GLCD_WriteChar(char charToWrite);

unsigned char column = 0;
unsigned char line = 0;
unsigned int  lcdAddress = 0;
unsigned int  flashAddress = 0;
static unsigned char dataLcdBuffer[100];
static unsigned char dataLcdBackupBuffer[200];
unsigned int  backupLcdAddress = 0;

const char LcdRaster[] __attribute__ ((progmem)) = {
255,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1
,1,1,1,3,1,1,1,1,1,1,1,1,1,3,1,1
,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1
,1,171,1,1,1,1,1,1,1,1,1,3,1,1,1,1
,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,3
,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1
,1,1,1,1,255,0,0,240,248,140,140,248,240,0,0,252
,252,0,0,252,252,0,0,4,252,252,68,196,252,56,0,0
,255,8,0,0,0,0,0,0,0,8,0,0,0,0,0,0
,0,0,0,8,0,0,0,0,0,0,0,0,0,8,0,0
,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0
,8,170,8,0,0,0,0,0,0,0,0,8,0,0,0,0
,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,8
,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0
,0,0,0,8,255,0,0,199,39,32,192,7,7,0,0,1
,3,6,6,3,1,0,0,4,7,7,0,0,7,7,0,0
,255,32,0,0,0,0,0,0,0,32,0,0,0,0,0,0
,0,0,0,32,0,0,0,0,0,0,0,0,0,32,0,0
,0,0,0,0,0,0,0,32,0,0,0,0,0,0,0,0
,32,170,32,0,0,0,0,0,0,0,0,32,0,0,0,0
,0,0,0,0,0,32,0,0,0,0,0,0,0,0,0,32
,0,0,0,0,0,0,0,0,0,32,0,0,0,0,0,0
,0,0,0,32,255,0,0,25,34,34,28,0,30,33,33,33
,0,30,33,33,30,0,255,33,33,30,0,30,41,41,46,0
,255,128,0,128,0,128,0,128,0,192,0,128,0,128,0,128
,0,128,0,192,0,128,0,128,0,128,0,128,0,192,0,128
,0,128,0,128,0,128,0,192,0,128,0,128,0,128,0,128
,0,170,0,128,0,128,0,128,0,128,0,192,0,128,0,128
,0,128,0,128,0,192,0,128,0,128,0,128,0,128,0,192
,0,128,0,128,0,128,0,128,0,192,0,128,0,128,0,128
,0,128,0,128,255,0,40,32,40,32,40,0,0,0,0,0
,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
,255,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0
,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0
,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0
,0,170,0,0,0,0,0,0,0,0,0,1,0,0,0,0
,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0
,0,0,0,0,255,0,16,8,16,32,16,0,0,0,0,0
,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
,255,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0
,0,0,0,2,0,0,0,0,0,0,0,0,0,2,0,0
,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0
,2,170,2,0,0,0,0,0,0,0,0,2,0,0,0,0
,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,2
,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0
,0,0,0,2,255,0,0,0,0,0,0,0,0,0,0,0
,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
,255,8,0,0,0,0,0,0,0,8,0,0,0,0,0,0
,0,0,0,8,0,0,0,0,0,0,0,0,0,8,0,0
,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0
,8,170,8,0,0,0,0,0,0,0,0,8,0,0,0,0
,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,8
,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0
,0,0,0,8,255,0,0,124,20,4,0,124,20,104,0,124
,84,68,0,56,68,68,120,0,0,0,0,0,0,0,0,0
,255,128,128,128,128,128,128,128,128,160,128,128,128,128,128,128
,128,128,128,160,128,128,128,128,128,128,128,128,128,160,128,128
,128,128,128,128,128,128,128,160,128,128,128,128,128,128,128,128
,128,170,128,128,128,128,128,128,128,128,128,160,128,128,128,128
,128,128,128,128,128,160,128,128,128,128,128,128,128,128,128,160
,128,128,128,128,128,128,128,128,128,160,128,128,128,128,128,128
,128,128,128,128,255,0,0,0,0,0,0,0,0,0,0,0
,0,0,0,0,0,0,0,124,16,124,0,72,104,88,0,0
};


const char welcomeScreen[] __attribute__ ((progmem)) = {
255,1,1,1,1,1,1,1,129,129,65,33,33,17,17,17
, 17,17,17,17,17,33,33,65,65,129,129,1,1,1,1,1
, 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
, 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
, 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
, 1,1,129,193,97,33,161,241,241,241,241,49,1,1,1,17
, 25,9,13,5,189,253,113,1,1,1,145,241,113,17,145,193
, 225,33,49,145,241,241,49,17,145,241,113,1,1,1,1,255
, 255,0,16,0,16,24,4,18,1,16,0,16,0,16,0,16
, 0,16,0,16,0,16,0,16,0,16,0,17,2,20,4,24
, 16,16,32,80,128,144,0,16,0,16,0,16,0,16,0,16
, 0,16,0,16,0,16,0,16,0,16,128,80,32,16,0,16
, 0,0,0,0,0,0,0,0,0,0,0,192,192,128,128,192
, 96,48,56,12,14,11,137,248,255,255,195,64,0,0,0,0
, 0,0,128,248,127,55,24,12,6,3,1,0,128,128,192,192
, 240,188,31,7,3,62,254,255,193,64,64,0,0,0,0,255
, 255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
, 0,128,128,0,0,0,1,130,4,4,8,8,8,16,16,16
, 144,16,16,16,16,8,8,4,2,1,128,0,0,0,0,0
, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
, 0,0,0,0,0,0,0,0,0,0,0,0,128,128,0,0
, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255
, 255,0,0,0,0,0,0,240,248,60,14,7,14,252,240,0
, 0,0,112,248,156,140,6,7,3,2,0,0,224,248,124,30
, 15,7,3,1,0,224,126,15,1,0,0,0,0,0,224,254
, 31,7,0,0,0,0,0,0,224,254,31,7,0,0,0,0
, 0,0,240,248,60,14,7,14,252,240,0,0,0,112,248,156
, 140,6,7,3,2,0,0,224,248,124,30,15,7,3,1,0
, 240,248,60,14,7,14,252,240,0,0,0,244,254,254,34,18
, 14,0,0,0,240,254,63,19,19,19,1,0,0,0,0,255
, 255,0,0,0,0,0,0,1,3,2,6,6,3,3,1,0
, 0,0,8,8,8,8,9,6,0,0,0,0,1,3,2,2
, 2,0,0,0,0,15,0,0,0,0,0,0,0,0,3,2
, 6,6,6,2,2,2,2,0,3,2,6,6,6,2,2,2
, 2,0,1,3,2,6,6,3,3,1,0,0,0,8,8,8
, 8,9,6,0,0,0,0,1,3,2,2,2,0,0,0,0
, 1,3,2,6,6,3,3,1,0,0,0,7,3,0,0,0
, 0,0,0,0,1,3,2,2,3,1,1,0,0,0,0,255
, 255,0,0,252,2,0,0,224,16,16,16,0,0,2,252,0
, 0,0,0,0,0,0,140,66,34,28,0,252,2,2,254,0
, 252,2,2,254,0,2,130,98,30,0,32,32,32,32,0,140
, 66,34,28,0,252,2,2,254,0,8,4,254,0,0,8,4
, 254,0,0,0,0,0,0,0,254,16,16,224,0,240,0,0
, 240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
, 0,224,224,0,0,0,0,64,32,0,0,96,0,16,48,224
, 64,0,0,0,0,128,224,32,16,16,224,192,0,0,0,255
, 255,0,0,225,2,0,224,1,2,2,2,0,0,2,1,0
, 0,0,0,0,0,0,3,2,2,66,0,3,2,34,225,0
, 3,2,2,65,0,0,3,0,0,0,0,0,0,0,0,3
, 194,34,34,192,3,2,2,1,0,2,2,3,2,0,2,2
, 3,2,0,0,0,0,0,0,3,2,2,65,0,9,10,10
, 7,224,0,0,0,64,0,0,0,0,0,0,0,0,0,0
, 0,3,63,60,8,6,1,0,0,48,56,36,32,34,33,1
, 0,48,48,0,14,63,33,0,32,28,15,3,0,0,0,255
, 255,128,128,131,140,176,143,128,152,165,165,190,128,146,165,169
, 146,128,146,165,169,146,128,128,160,191,160,128,128,160,191,160
, 128,128,160,191,160,128,146,165,169,146,128,128,128,128,128,128
, 153,162,162,156,128,158,169,169,174,128,129,190,129,131,128,152
, 165,165,190,128,146,165,169,146,128,128,160,191,160,128,158,161
, 161,191,128,128,160,191,160,128,146,165,169,146,128,128,128,128
, 128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128
, 128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,255
};


